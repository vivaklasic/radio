<script>
  let username = "";

  async function startRadio() {
    username = document.getElementById("username").value || "–ì–æ—Å—Ç—å";
    const res = await fetch("/start", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username })
    });
    const data = await res.json();

    if (data.voice) {
      // –ï—Å–ª–∏ –µ—Å—Ç—å –∞—É–¥–∏–æ, –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º
      const vp = document.getElementById("voicePlayer");
      vp.src = data.voice;
      vp.style.display = "inline";
      document.getElementById("voiceStatus").innerText = "üîä –°–ª—É—à–∞–π...";
    } else if (data.text) {
      // –ï—Å–ª–∏ –Ω–µ—Ç –æ–∑–≤—É—á–∫–∏, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç
      document.getElementById("voiceStatus").innerText = data.text;
      // –°–∫—Ä—ã–≤–∞–µ–º –∞—É–¥–∏–æ-–ø–ª–µ–µ—Ä, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –ø—É—Å—Ç–æ–≥–æ –±–ª–æ–∫–∞
      document.getElementById("voicePlayer").style.display = "none";
    }

    document.getElementById("startBlock").style.display = "none";
    document.getElementById("controlBlock").style.display = "block";
  }

  async function sendRequest() {
    const input = document.getElementById("musicRequest").value;
    document.getElementById("voiceStatus").innerText = "üîä –î—É–º–∞—é...";
    const res = await fetch("/suggest", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ input })
    });
    const data = await res.json();

    if (data.voice) {
      const vp = document.getElementById("voicePlayer");
      vp.src = data.voice;
      vp.style.display = "inline";
      document.getElementById("voiceStatus").innerText = "üéôÔ∏è –û–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞";
    } else if (data.text) {
      document.getElementById("voiceStatus").innerText = data.text;
      document.getElementById("voicePlayer").style.display = "none";
    }

    document.getElementById("musicPlayer").src = data.track;
    document.getElementById("trackTitle").innerText = data.title;
  }
</script>
