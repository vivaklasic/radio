<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–õ–∏—á–Ω–æ–µ –†–∞–¥–∏–æ</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2em; background: #f0f0f0; }
    input, button { padding: 10px; font-size: 16px; margin: 10px; }
    audio { margin-top: 20px; width: 300px; }
  </style>
</head>
<body>
  <h1>üéß –¢–≤–æ—ë –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ –†–∞–¥–∏–æ</h1>

  <div id="startBlock">
    <input type="text" id="username" placeholder="–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?" />
    <button onclick="startRadio()">–ó–∞–ø—É—Å—Ç–∏—Ç—å</button>
  </div>

  <div id="controlBlock" style="display:none">
    <p id="voiceStatus">üîä –ü–æ–¥–æ–∂–¥–∏—Ç–µ...</p>
    <audio id="voicePlayer" controls autoplay></audio>

    <br>
    <input type="text" id="musicRequest" placeholder="–ß—Ç–æ —Ö–æ—á–µ—à—å –ø–æ—Å–ª—É—à–∞—Ç—å?" />
    <button onclick="sendRequest()">–ü–æ–∂–µ–ª–∞–Ω–∏–µ</button>

    <p id="trackTitle"></p>
    <audio id="musicPlayer" controls></audio>
  </div>

  <script>
    let username = "";

    async function startRadio() {
      username = document.getElementById("username").value || "–ì–æ—Å—Ç—å";
      const res = await fetch("/start", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username })
      });
      const data = await res.json();
      document.getElementById("voicePlayer").src = data.voice;
      document.getElementById("startBlock").style.display = "none";
      document.getElementById("controlBlock").style.display = "block";
    }

    async function sendRequest() {
      const input = document.getElementById("musicRequest").value;
      document.getElementById("voiceStatus").innerText = "üîä –î—É–º–∞—é...";
      const res = await fetch("/suggest", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ input })
      });
      const data = await res.json();
      document.getElementById("voicePlayer").src = data.voice;
      document.getElementById("musicPlayer").src = data.track;
      document.getElementById("trackTitle").innerText = data.title;
      document.getElementById("voiceStatus").innerText = "üéôÔ∏è –û–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞";
    }
  </script>
</body>
</html>
